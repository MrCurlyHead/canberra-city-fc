{% extends "base.html" %}
{% block title %}Player Details{% endblock %}
{% block content %}
<div class="glass-card light">
  <div class="section-heading">
    <h1 class="mb-0">Player Details</h1>
    <span class="badge-soft">{{ players|length }} registered players</span>
  </div>

  {% if session.logged_in %}
  <form method="post">
  {% endif %}

  <!-- Desktop Table (hidden on small screens) -->
  <div class="d-none d-md-block">
    <table class="table table-modern align-middle players-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Preferred Position</th>
          <th>Shirt Number</th>
          <th>Beer Duty Date</th>
          <th>Support Offered</th>
          {% if session.logged_in %}
          <th class="text-end">Delete</th>
          {% endif %}
        </tr>
      </thead>
      <tbody>
        {% for p in players %}
        <tr>
          <td>
            {% if session.logged_in %}
              <input type="text" class="form-control" name="name_{{ p.id }}" value="{{ p.name }}">
            {% else %}
              {{ p.name }}
            {% endif %}
          </td>
          <td>
            {% if session.logged_in %}
              <input type="text" class="form-control" name="preferred_position_{{ p.id }}" value="{{ p.preferred_position or '' }}">
            {% else %}
              {{ p.preferred_position or '' }}
            {% endif %}
          </td>
          <td>
            {% if session.logged_in %}
              <input type="text" class="form-control" name="shirt_{{ p.id }}" value="{{ p.shirt_number or '' }}">
            {% else %}
              {{ p.shirt_number or '' }}
            {% endif %}
          </td>
          <td>
            {% if session.logged_in %}
              <input type="date" class="form-control" name="beer_duty_date_{{ p.id }}" value="{{ p.beer_duty_date|default('') }}">
            {% else %}
              {{ p.beer_duty_date|default('') }}
            {% endif %}
          </td>
          <td style="min-width: 220px;">
            {% if session.logged_in %}
              <textarea class="form-control" name="support_offered_{{ p.id }}" rows="2">{{ p.support_offered or '' }}</textarea>
            {% else %}
              {{ p.support_offered or '' }}
            {% endif %}
          </td>
          {% if session.logged_in %}
          <td class="text-end">
            <a href="{{ url_for('delete_player', player_id=p.id) }}" class="btn btn-danger-soft btn-sm" onclick="return confirm('Delete {{ p.name }}?');">Delete</a>
          </td>
          {% endif %}
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Mobile Card Layout -->
  <div class="d-md-none">
    {% for p in players %}
    <div class="glass-card">
      <div class="mb-2">
        <label class="form-label">Name</label>
        {% if session.logged_in %}
          <input type="text" class="form-control" name="name_{{ p.id }}" value="{{ p.name }}">
        {% else %}
          {{ p.name }}
        {% endif %}
      </div>
      <div class="mb-2">
        <label class="form-label">Preferred Position</label>
        {% if session.logged_in %}
          <input type="text" class="form-control" name="preferred_position_{{ p.id }}" value="{{ p.preferred_position or '' }}">
        {% else %}
          {{ p.preferred_position or '' }}
        {% endif %}
      </div>
      <div class="mb-2">
        <label class="form-label">Shirt Number</label>
        {% if session.logged_in %}
          <input type="text" class="form-control" name="shirt_{{ p.id }}" value="{{ p.shirt_number or '' }}">
        {% else %}
          {{ p.shirt_number or '' }}
        {% endif %}
      </div>
      <div class="mb-2">
        <label class="form-label">Beer Duty Date</label>
        {% if session.logged_in %}
          <input type="date" class="form-control" name="beer_duty_date_{{ p.id }}" value="{{ p.beer_duty_date|default('') }}">
        {% else %}
          {{ p.beer_duty_date|default('') }}
        {% endif %}
      </div>
      <div class="mb-2">
        <label class="form-label">Support Offered</label>
        {% if session.logged_in %}
          <textarea class="form-control" name="support_offered_{{ p.id }}" rows="2">{{ p.support_offered or '' }}</textarea>
        {% else %}
          {{ p.support_offered or '' }}
        {% endif %}
      </div>
      {% if session.logged_in %}
      <a href="{{ url_for('delete_player', player_id=p.id) }}" class="btn btn-danger-soft btn-sm mt-2" onclick="return confirm('Delete {{ p.name }}?');">Delete</a>
      {% endif %}
    </div>
    {% endfor %}
  </div>

  {% if session.logged_in %}
    <div class="text-end">
      <button type="submit" class="btn-glow mt-3">Save Changes</button>
    </div>
  </form>

  <div class="glass-card mt-4">
    <h4 class="mb-3">Add New Player</h4>
    <form method="post" action="{{ url_for('add_player') }}">
      <div class="mb-3">
        <input type="text" class="form-control" name="new_player_name" placeholder="Full Name" required>
      </div>
      <button type="submit" class="btn-soft">Add Player</button>
    </form>
  </div>
  {% endif %}
</div>
{% endblock %}
