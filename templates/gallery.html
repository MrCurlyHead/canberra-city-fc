{% extends "base.html" %}
{% block title %}Gallery{% endblock %}
{% block content %}
<div class="container">
  <h1 class="mb-4">Gallery</h1>

  <ul class="nav nav-tabs mb-3">
    <li class="nav-item">
      <a class="nav-link {% if active_year == 2025 %}active{% endif %}" href="{{ url_for('gallery', year=2025) }}">2025</a>
    </li>
    <li class="nav-item">
      <a class="nav-link {% if active_year == 2026 %}active{% endif %}" href="{{ url_for('gallery', year=2026) }}">2026</a>
    </li>
  </ul>

  {% if session.logged_in %}
  <div class="card mb-4">
    <div class="card-body">
      <form method="post" action="{{ url_for('gallery_upload') }}" enctype="multipart/form-data" class="row g-2 align-items-center">
        <div class="col-sm-4">
          <input class="form-control" type="file" name="file" accept=".png,.jpg,.jpeg,.gif,.webp,.mp4,.mov,.avi" required>
        </div>
        <div class="col-sm-3">
          <select name="year" class="form-select">
            <option value="2025" {% if active_year == 2025 %}selected{% endif %}>2025</option>
            <option value="2026" {% if active_year == 2026 %}selected{% endif %}>2026</option>
          </select>
        </div>
        <div class="col-sm-3">
          <button class="btn btn-primary" type="submit">Upload</button>
        </div>
      </form>
    </div>
  </div>
  {% endif %}

  {% if media_files %}
  <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-3">
    {% for name in media_files %}
    {% set ext = name.rsplit('.', 1)[1].lower() %}
    <div class="col">
      <div class="card h-100">
        {% if ext in ['mp4','mov','avi'] %}
        <video class="card-img-top" controls preload="metadata">
          <source src="{{ url_for('gallery_media', year=active_year, filename=name) }}" type="video/{{ 'mp4' if ext == 'mp4' else 'mp4' }}">
        </video>
        {% else %}
        <img class="card-img-top" src="{{ url_for('gallery_media', year=active_year, filename=name) }}" alt="{{ name }}">
        {% endif %}
        <div class="card-body py-2">
          <small class="text-muted">{{ name }}</small>
        </div>
      </div>
    </div>
    {% endfor %}
  </div>
  {% else %}
  <div class="alert alert-info">No media found for {{ active_year }} yet.</div>
  {% endif %}
</div>
{% endblock %}


